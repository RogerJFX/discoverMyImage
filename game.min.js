window.$disc=window.$disc||{},function(t){t.MAX_IMAGE_WIDTH=1e3,t.MAX_IMAGE_HEIGHT=800,t.DOUBLE_CLICK_TIMEOUT=500,t.AUTO_PLAY_TIMEOUT=250,t.ANI_STEPS_TRANSLATECARD=5,t.ANI_STEPS_APPENDCARD=3,t.ANI_APPENDCARD_RESOLVE_AFTER=1,t.MILLIS_PER_STEP=25}(window.$disc.constants=window.$disc.constants||{}),window.$disc=window.$disc||{},function(t){function e(t,e){const n=document.createElement("CANVAS");return n.setAttribute("width",t+""),n.setAttribute("height",e+""),n}t.resizeImage=(t=>{const n=window.$disc.constants.MAX_IMAGE_HEIGHT,o=window.$disc.constants.MAX_IMAGE_WIDTH;return new Promise(i=>{if(t.width<=o&&t.height<=n)return void i(t);let a=0;if(t.width>=o&&(a=t.width/o),t.height>=n){const e=t.height/n;e>a&&(a=e)}const s=function(n,o){const i=e(n,o);i.getContext("2d").drawImage(t,0,0,n,o);const a=new Image;return a.src=i.toDataURL("image/jpg"),a}(t.width/a,t.height/a);s.onload=(()=>i(s))})}),t.increaseTransparency=((t,e)=>{const n=e||.5;for(let e=0;e<t.width*t.height*4;e+=4)t.data[e+3]=Math.round(t.data[e+3]*n)}),t.simpleDarken=((t,e)=>{const n=e||.23;for(let e=0;e<t.width*t.height*4;e+=4)t.data[e]=Math.round(t.data[e]*n),t.data[e+1]=Math.round(t.data[e+1]*n),t.data[e+2]=Math.round(t.data[e+2]*n)}),t.convert2BW=(t=>{for(let e=0;e<t.width*t.height*4;e+=4){const n=t.data[e]+t.data[e+1]+t.data[e+2],o=Math.round(n/3);t.data[e]=o,t.data[e+1]=o,t.data[e+2]=o}}),t.modifyImage=((t,n)=>{const o=t.width,i=t.height,a=e(o,i).getContext("2d");a.drawImage(t,0,0,o,i);const s=a.getImageData(0,0,o,i);n.forEach(t=>t(s));const d=e(o,i);d.getContext("2d").putImageData(s,0,0);const r=new Image;return r.src=d.toDataURL("image/jpg"),new Promise(t=>{r.onload=(()=>t(r))})}),t.getFile=(e=>{e.stopPropagation(),e.preventDefault();const n=[...e.dataTransfer?e.dataTransfer.files:e.target.files].filter(t=>t.type.match("image.*"))[0];return new Promise((e,o)=>{if(n){const o=new FileReader;o.addEventListener("load",n=>{const o=new Image;o.src=n.target.result+"",o.onload=(()=>{t.resizeImage(o).then(t=>{e(t)}).catch(t=>console.log(t))})},!0),o.readAsDataURL(n)}else o("No image")})})}(window.$disc.imageHandler=window.$disc.imageHandler||{}),window.$disc=window.$disc||{},function(t){let e,n,o,i,a,s,d=[],r=!1;function c(t,i,a,c){let l,h=!1;const w=this;function u(){if(r)return;const t=function(t){const e=d.indexOf(d.find(t=>-1!==t.indexOf(null))),n=d[e].indexOf(null),o=t.getCoords();if(o[0]===n&&1===Math.abs(o[1]-e)||o[1]===e&&1===Math.abs(o[0]-n))return{tile:d[e][n],xPos:n,yPos:e};return null}(w);var i,h;null!==t&&(r=!0,h=t,d[(i={tile:w,xPos:a,yPos:c}).yPos][i.xPos]=h.tile,d[h.yPos][h.xPos]=i.tile,a=t.xPos,c=t.yPos,window.$disc.animator.translateCard(l,a*e,c*n).then(t=>{r=!1,o.find(t=>!t.isCorrectPlaced())||s()}))}this.toNode=(()=>((l=document.createElement("DIV")).setAttribute("style",`\n                left: ${a*e}px;\n                top: ${c*n}px;\n                background-position: -${t*e}px -${i*n}px;\n            `),l.setAttribute("class","tile"),h&&(l.style.display="none"),l.onclick=u,l)),this.setOmitted=(()=>{h=!0}),this.isOmitted=(()=>h),this.isCorrectPlaced=(()=>h||t===a&&i===c),this.getCoords=(()=>[a,c])}t.buildTiles=((t,r,l,h)=>{s=h,i=r,a=l,function(){d=[];for(let t=0;t<a;t++){d.push([]);for(let e=0;e<i;e++)d[t].push(null)}}();const w=i*a,u=[];function f(){const t=Math.floor(Math.random()*w);return u.includes(t)?f():t}for(let t=0;t<w;t++)u.push(f());e=Math.floor(t.width/i),n=Math.floor(t.height/a),function(t){const o=document.body.getElementsByTagName("stylecontainer")[0],i=document.createElement("STYLE");i.innerHTML+=`\n.tile {\n            background-image: URL(${t.src});\n            width: ${e}px;\n            height: ${n}px;\n        }`,o.innerHTML="",o.appendChild(i)}(t);const g=[];for(let t=0;t<w;t++)g.push(new c(t%i,Math.floor(t/i)%a,u[t]%i,Math.floor(u[t]/i)%a));return g[Math.floor(Math.random()*w)].setOmitted(),(o=g).forEach(t=>{if(!t.isOmitted()){const e=t.getCoords();d[e[1]][e[0]]=t}}),g})}(window.$disc.tileManager=window.$disc.tileManager||{}),window.$disc=window.$disc||{},function(t){t.translateCard=((t,e,n,o,i)=>{const a=o||$disc.constants.ANI_STEPS_TRANSLATECARD,s=i||a;let d=!1;return new Promise(o=>{const i=t.offsetLeft,r=t.offsetTop,c=(e-i)/a,l=(n-r)/a,h=[],w=[];for(let t=0;t<a;t++)h.push(i+c*t),w.push(r+l*t);let u=0;const f=t.style.zIndex;t.style.zIndex="7777";const g=window.setInterval(()=>{u<a?(t.style.left=h[u]+"px",t.style.top=w[u]+"px",u===s&&(d=!0,o()),u++):(t.style.left=e+"px",t.style.top=n+"px",window.clearInterval(g),t.style.zIndex=f,d||o())},$disc.constants.MILLIS_PER_STEP)})})}(window.$disc.animator=window.$disc.animator||{});